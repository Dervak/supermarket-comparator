---
import '@/styles/globals.css'
import Layout from '../layouts/Layout.astro';
import { Button } from "@/components/ui/button"
import { Input } from "@/components/ui/input"
import { Table, TableBody, TableCell, TableHead, TableHeader, TableRow } from "@/components/ui/table"
import { PrismaClient } from '@prisma/client'

const prisma = new PrismaClient()

const products = await prisma.product.findMany({
  include: {
    prices: {
      include: {
        supermarket: true
      }
    }
  }
})

await prisma.$disconnect()
---

<Layout title="Argentinean Supermarket Comparator">
  <main class="container mx-auto p-4">
    <h1 class="text-3xl font-bold mb-4">Argentinean Supermarket Comparator</h1>
    <div class="mb-4">
      <Input type="text" placeholder="Search products..." class="w-full" />
    </div>
    <Table>
      <TableHeader>
        <TableRow>
          <TableHead>Product</TableHead>
          <TableHead>EAN</TableHead>
          {['Coto', 'Jumbo', 'Carrefour Argentina', 'Disco', 'Dia Argentina', 'Chango Más', 'Vea'].map((supermarket) => (
            <TableHead>{supermarket}</TableHead>
          ))}
        </TableRow>
      </TableHeader>
      <TableBody>
        {products.map((product) => (
          <TableRow>
            <TableCell>{product.name}</TableCell>
            <TableCell>{product.ean}</TableCell>
            {['Coto', 'Jumbo', 'Carrefour Argentina', 'Disco', 'Dia Argentina', 'Chango Más', 'Vea'].map((supermarket) => (
              <TableCell>
                {product.prices.find((price) => price.supermarket.name === supermarket)?.price || '-'}
              </TableCell>
            ))}
          </TableRow>
        ))}
      </TableBody>
    </Table>
  </main>
</Layout>